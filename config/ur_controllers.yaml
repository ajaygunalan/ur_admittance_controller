controller_manager:
  ros__parameters:
    update_rate: 500  # Hz

    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    scaled_joint_trajectory_controller:
      type: joint_trajectory_controller/JointTrajectoryController

    ur_admittance_controller:
      type: ur_admittance_controller/AdmittanceController

    force_torque_sensor_broadcaster:
      type: force_torque_sensor_broadcaster/ForceTorqueSensorBroadcaster

joint_state_broadcaster:
  ros__parameters:
    joints:
      - shoulder_pan_joint
      - shoulder_lift_joint
      - elbow_joint
      - wrist_1_joint
      - wrist_2_joint
      - wrist_3_joint

scaled_joint_trajectory_controller:
  ros__parameters:
    joints:
      - shoulder_pan_joint
      - shoulder_lift_joint
      - elbow_joint
      - wrist_1_joint
      - wrist_2_joint
      - wrist_3_joint

    command_interfaces:
      - position

    state_interfaces:
      - position
      - velocity

    state_publish_rate: 100.0
    action_monitor_rate: 20.0

    constraints:
      stopped_velocity_tolerance: 0.2
      goal_time: 1.5
      shoulder_pan_joint:
        trajectory: 0.3
        goal: 0.1
      shoulder_lift_joint:
        trajectory: 0.3
        goal: 0.1
      elbow_joint:
        trajectory: 0.3
        goal: 0.1
      wrist_1_joint:
        trajectory: 0.3
        goal: 0.1
      wrist_2_joint:
        trajectory: 0.3
        goal: 0.1
      wrist_3_joint:
        trajectory: 0.3
        goal: 0.1

ur_admittance_controller:
  ros__parameters:
    joints:
      - shoulder_pan_joint
      - shoulder_lift_joint
      - elbow_joint
      - wrist_1_joint
      - wrist_2_joint
      - wrist_3_joint

    command_interfaces:
      - position
      - velocity

    state_interfaces:
      - position
      - velocity

    kinematics_plugin_name: "kinematics_interface_kdl/KinematicsInterfaceKDL"
    kinematics_plugin_package: "kinematics_interface_kdl"

    base_link: "base_link"
    tip_link: "tool0"
    jacobian_damping: 0.01

    ft_sensor_name: "wrist_ft_sensor"
    ft_frame: "wrist_3_link"
    filter_coefficient: 0.05

    control_frame: "tool0"
    world_frame: "world"
    gravity_compensation_frame: "wrist_3_link"
    center_of_gravity: [0.0, 0.0, 0.0]
    weight: 0.0

    admittance_enabled_axes: [true, true, true, true, true, true]
    
    # Admittance parameters - increased mass for stability in simulation
    mass: [20.0, 20.0, 20.0, 20.0, 20.0, 20.0]
    damping_ratio: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
    stiffness: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
    joint_damping: 5.0
    
    # Trajectory generation parameters
    velocity_scale_factor: 0.6  # Scale factor for simulation stability
    min_motion_threshold: 0.01  # Deadband to prevent tiny movements
    trajectory_duration: 3.0    # Longer duration for smoother motion
    
    # Tolerances - increased for simulation environment
    position_tolerance: 0.3     # radians
    velocity_tolerance: 1.5     # rad/s
    goal_time_tolerance: 1.5    # seconds
    
    # Retry mechanism
    retry_on_abort: true
    max_retries: 3
    retry_delay: 1.0            # seconds
    
    dynamic_parameters: true

force_torque_sensor_broadcaster:
  ros__parameters:
    sensor_name: wrist_ft_sensor
    frame_id: wrist_3_link
    interface_names:
      - force.x
      - force.y
      - force.z
      - torque.x
      - torque.y
      - torque.z
